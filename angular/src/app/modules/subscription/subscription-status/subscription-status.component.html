<mat-card *ngIf="subscriptionData$ | async as data; else loadingOrError" class="mat-elevation-z4">
  <div *ngIf="!data.isLoading && data.subscription; else loadingOrError">
    <mat-card-header>
      <mat-card-title>
        <mat-icon color="primary" aria-hidden="true">verified_user</mat-icon>
        Estado de la Suscripción
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <p><strong>Estado:</strong> <span [ngClass]="{'mat-accent': data.subscription.status === 'active', 'mat-warn': data.subscription.status !== 'active'}">{{ data.subscription.status }}</span></p>
      <p><strong>Plan:</strong> {{ data.subscription.plan || 'N/D' }}</p>
      <p *ngIf="data.subscription.currentPeriodEnd">
        <strong>Fin del periodo actual:</strong> {{ data.subscription.currentPeriodEnd | date:'medium' }}
      </p>
      <p *ngIf="data.subscription.cancelAtPeriodEnd">
        <mat-icon color="warn" aria-hidden="true">warning</mat-icon>
        La suscripción se cancelará al final del periodo actual.
      </p>
      <p *ngIf="data.subscription.currentPeriodStart">
        <strong>Fecha de inicio del periodo actual:</strong> {{ data.subscription.currentPeriodStart | date:'medium' }}
      </p>
      <p *ngIf="data.subscription.currentPeriodEnd">
        <strong>Fecha de finalización del periodo actual:</strong> {{ data.subscription.currentPeriodEnd | date:'medium' }}
      </p>
      <!-- Agrega más detalles si es necesario -->
    </mat-card-content>
  </div>
</mat-card>

<ng-template #loadingOrError>
  <div *ngIf="(subscriptionData$ | async)?.isLoading" class="loading-container">
    <mat-card class="mat-elevation-z2">
      <mat-card-content>
        <mat-progress-spinner mode="indeterminate" diameter="32"></mat-progress-spinner>
        <span class="ml-2">Cargando estado de la suscripción...</span>
      </mat-card-content>
    </mat-card>
  </div>
  <div *ngIf="!(subscriptionData$ | async)?.isLoading && !(subscriptionData$ | async)?.subscription">
    <mat-card class="mat-elevation-z2">
      <mat-card-content>
        <mat-icon color="warn" aria-hidden="true">error_outline</mat-icon>
        No se pudieron cargar los detalles de la suscripción o no se encontró una suscripción activa.
      </mat-card-content>
    </mat-card>
  </div>
</ng-template>
